{% extends "core/base.html" %}
{% load static %}

{% block title %}Calendario - Panel OVA{% endblock %}

{% block content %}
<section class="card calendar-card">
  <div class="card-header">
    <h2>Calendario de intervenciones</h2>
    <p class="card-sub">
      Vista mensual de las cirug√≠as programadas. Hac√© clic en un d√≠a o en un paciente para ver el detalle del d√≠a.
    </p>
  </div>

  <div id="calendar"></div>
</section>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      locale: "es",
      height: "auto",
      firstDay: 1,
      dayMaxEvents: 3,
      displayEventTime: false,
      eventDisplay: "block",

      headerToolbar: {
        left: "title",
        center: "",
        right: "today prev,next",
      },
      buttonText: {
        today: "Hoy",
      },

      // üëâ FullCalendar va a pedir los eventos a esta URL (JSON)
      events: "{% url 'core:calendar_events' %}",

      // Clic en un EVENTO -> vista diaria
      eventClick: function (info) {
        const dateStr = info.event.startStr.substring(0, 10);  // YYYY-MM-DD
        window.location.href = "{% url 'core:calendar_day' %}" + "?date=" + dateStr;
      },

      // Clic en un d√≠a vac√≠o -> misma vista diaria
      dateClick: function (info) {
        const dateStr = info.dateStr.substring(0, 10);
        window.location.href = "{% url 'core:calendar_day' %}" + "?date=" + dateStr;
      },
    });

    calendar.render();
  });
</script>
{% endblock %}
